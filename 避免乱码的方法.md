# 避免 Git 提交信息乱码的方法

## 核心原则
**所有包含中文的 Git 提交信息必须使用文件方式提交，不能直接使用 `-m` 参数。**

## 标准流程

### 1. 创建提交信息文件
```bash
# 创建提交信息文件（使用 UTF-8 编码）
echo "提交描述内容" > commit_message.txt
```

或者使用编辑器创建文件，确保保存为 UTF-8 编码。

### 2. 使用文件方式提交
```bash
# 使用 -F 参数从文件读取提交信息
git add <文件>
git commit -F commit_message.txt
```

### 3. 提交后清理
```bash
# 提交后删除临时文件
rm commit_message.txt
# 或 Windows 下
del commit_message.txt
```

## 完整示例

```bash
# 1. 创建提交信息文件
echo "修复 Web 平台启动问题，移除 main 函数的 async" > commit_message.txt

# 2. 添加文件
git add lib/main.dart

# 3. 使用文件方式提交
git commit -F commit_message.txt

# 4. 删除临时文件
rm commit_message.txt
```

## 注意事项

1. **永远不要使用 `-m` 参数直接提交中文信息**
   ```bash
   # ❌ 错误：会导致乱码
   git commit -m "修复 Web 平台启动问题"
   
   # ✅ 正确：使用文件方式
   git commit -F commit_message.txt
   ```

2. **确保文件编码为 UTF-8**
   - 在 Windows 上，使用记事本保存时选择 "UTF-8" 编码
   - 或使用 PowerShell 的 `echo` 命令创建文件（默认 UTF-8）

3. **PowerShell 编码设置**
   ```powershell
   # 设置 PowerShell 编码为 UTF-8
   chcp 65001
   ```

4. **提交信息文件命名**
   - 建议使用 `commit_message.txt` 作为标准文件名
   - 提交后立即删除，避免误提交

## 批量提交时的处理

如果需要提交多个文件，仍然使用文件方式：

```bash
# 创建提交信息文件
echo "修复多个问题：
- 修复 Web 平台启动问题
- 移除不必要的调试日志
- 优化窗口大小设置" > commit_message.txt

# 添加所有文件
git add file1.dart file2.dart file3.dart

# 使用文件方式提交
git commit -F commit_message.txt

# 删除临时文件
rm commit_message.txt
```

## 修复已存在的乱码提交

如果已经存在乱码提交，使用 `git replace` 修复：

```bash
# 1. 检出乱码提交
git checkout <乱码提交哈希>

# 2. 创建正确的提交信息文件
echo "正确的提交信息" > commit_message.txt

# 3. 修改提交信息
git commit --amend -F commit_message.txt

# 4. 使用 replace 替换
git replace <乱码提交哈希> HEAD

# 5. 返回主分支
git checkout main

# 6. 清理临时文件
rm commit_message.txt
```

## 总结

**关键点：**
- ✅ 使用 `git commit -F commit_message.txt` 而不是 `git commit -m "中文"`
- ✅ 确保文件使用 UTF-8 编码
- ✅ 提交后立即删除临时文件
- ✅ 在 PowerShell 中设置正确的编码（chcp 65001）

